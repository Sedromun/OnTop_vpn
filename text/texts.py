import datetime

from config import MIN_ADD_AMOUNT, INSTR_URL
from database.controllers.user import get_user, register_user
from utils.common import datetime_format
from utils.country import COUNTRIES
from utils.payment import get_order_perm_key, get_order_vless_key


def get_greeting_text():
    return (
        "üéâ –ü—Ä–∏–≤–µ—Ç! –¢—ã –≤ <b>Clique VPN</b> ‚Äî –≥–¥–µ –¥–æ—Å—Ç—É–ø –∫ –ª—é–±–∏–º—ã–º —Å–µ—Ä–≤–∏—Å–∞–º"
        " –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.\n\n"
        "–î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–æ—Å–ø–æ–ª—å–∑—É–π—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π:\n\n"
        "üõí <b>–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</b> - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏ —Å–∫–∏–¥–∫–∏\n\n"
        "üë´ <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b> - –ø—Ä–∏–≥–ª–∞—à–∞–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π\n\n"
        "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–∞—Ö –∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω—ã\n\n"
        f"–ê –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —Ç—ã –Ω–∞–π–¥–µ—à—å <a href='{INSTR_URL}'>–∑–¥–µ—Å—å</a>"
    )


def get_present_greeting_text():
    return (
        "‚ù§ –ü—Ä–∏–≤–µ—Ç! –¢–≤–æ–π –¥—Ä—É–≥ –ø–æ–¥–∞—Ä–∏–ª —Ç–µ–±–µ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –Ω–∞—à —Å–µ—Ä–≤–∏—Å. –û–Ω–∞ —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –Ω–∏–∂–µ\n\n"
        "–î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–æ—Å–ø–æ–ª—å–∑—É–π—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π:\n\n"
        "üõí <b>–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</b> - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏ —Å–∫–∏–¥–∫–∏\n\n"
        "üë´ <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b> - –ø—Ä–∏–≥–ª–∞—à–∞–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π\n\n"
        "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–∞—Ö –∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω—ã\n\n"
        f"–ê –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—é —Ç—ã –Ω–∞–π–¥–µ—à—å <a href='{INSTR_URL}'>–∑–¥–µ—Å—å</a>"
    )


def get_incorrect_command():
    return "–¢–∞–∫–æ–π –∫–æ–º–∞–Ω–¥—ã –Ω–µ—Ç"


def get_information_text():
    return "‚öôÔ∏è –ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∏–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª—é—á–µ–π –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–π –±–∞–ª–∞–Ω—Å"


def get_profile_text(id: int):
    user = get_user(id)
    if user is None:
        register_user(id)
    return (
        f"üìÇ <b>–¢–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å:</b> \n\n"
        f"üí∞ –ë–∞–ª–∞–Ω—Å: {str(user.balance)} ‚ÇΩ\n\n"
        f"üÜî ID: {str(id)}"
    )


def get_buy_vpn_text():
    return "üéØÔ∏è <b>–í—ã–±–µ—Ä–∏ —Ç–∏–ø –ø–æ–¥–ø–∏—Å–∫–∏</b>:"


def get_payment_option_text(amount: int, balance: int):
    return (
        f"üí∏ –ö –æ–ø–ª–∞—Ç–µ {amount}‚ÇΩ\n\nüè¶–ù–∞ –±–∞–ª–∞–Ω—Å–µ {balance}‚ÇΩ\n\n<b>–í—ã–±–µ—Ä–∏ —Ç–∏–ø –æ–ø–ª–∞—Ç—ã:</b>"
    )


def get_success_created_key_text(key: str):
    return "üéâ <b>–ë–ª–∞–≥–æ–¥–∞—Ä–∏–º –∑–∞ –ø–æ–∫—É–ø–∫—É!</b>\n\n"


def get_success_created_present_text(link: str):
    return (f"üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–æ–∫—É–ø–∫–æ–π!</b>\n\n–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ø–æ–¥–∞—Ä–∫–∞ - "
            f"–æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –ø–æ–ª—É—á–∞—Ç–µ–ª—é –ø–æ–¥–∞—Ä–∫–∞ <i>(—Å–∞–º–∏ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Å—ã–ª–∫—É - –æ–Ω–∞ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è)</i>:\n\n <code>{link}</code>")


def get_payment_choose_country_text():
    return "üåç –í—ã–±–µ—Ä–∏ <b>—Å—Ç—Ä–∞–Ω—É</b> –¥–ª—è <b>VPN</b>\n<i>(–ï—ë –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å)</i>"

def get_person_option_buy_text():
    return "–î–ª—è –∫–æ–≥–æ —Ç—ã —Ö–æ—á–µ—à—å –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É?"


def get_not_enough_money_text(add: int):
    return (
            "‚ùå <b>–ù–∞ –±–∞–ª–∞–Ω—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤</b>\n\n–ù–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ: "
            + str(add)
            + "‚ÇΩ\n\n<i>–í—ã–±–µ—Ä–∏ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è</i>"
            + (
                f"\n–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è {MIN_ADD_AMOUNT}‚ÇΩ"
                if add < MIN_ADD_AMOUNT
                else ""
            )
    )


def get_key_data(order):
    return (
            f"–°—Ç—Ä–∞–Ω–∞: {order.country} {COUNTRIES[order.country]}\n\n"
            f"–î–∞—Ç–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∫–ª—é—á–∞"
            + (
                " –∏ –ø—Ä–æ–¥–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"
                if (order.payment_id != "" and order.payment_id is not None)
                else ""
            )
            + f": {(order.expiration_date.astimezone(datetime.timezone.utc) + datetime.timedelta(hours=3)).strftime(datetime_format)}\n"
              f"(–æ—Å—Ç–∞–ª–æ—Å—å {get_left_time(order.expiration_date.astimezone(datetime.timezone.utc))})\n\n"
              f"–ö–ª—é—á–∏ (–Ω–∞–∂–º–∏, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å):\n\n<i>VLESS:</i>\n<code>{get_order_vless_key(order.id)}</code>"
              f"\n\n<i>Outline:</i>\n<code>{get_order_perm_key(order.id)}</code>"
            + "\n\n<i>–°–æ–≤–µ—Ç—É–µ–º –≤—ã–±–∏—Ä–∞—Ç—å VLESS (–æ–Ω —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –∏ –±—ã—Å—Ç—Ä–µ–µ)\n<b>–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</b></i> üëá"
    )


def get_left_time(expiration_date: datetime.datetime):
    current = datetime.datetime.now(datetime.timezone.utc)
    if (expiration_date - current).days > 0:
        return str((expiration_date - current).days) + " –¥–Ω–µ–π"
    elif (expiration_date - current).seconds // 3600 > 0:
        return str((expiration_date - current).seconds // 3600) + " —á–∞—Å–æ–≤"
    else:
        return str((expiration_date - current).seconds // 60) + " –º–∏–Ω—É—Ç"


def get_payment_text():
    return "ü´∞ –û–ø–ª–∞—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ"


def get_old_user_message_start_text():
    return (
        "‚ù§Ô∏è –ü—Ä–∏–≤–µ—Ç! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –¥–æ–≤–µ—Ä—è–µ—à—å –Ω–∞–º!\n\n"
        "–í —ç—Ç–æ–º –±–æ—Ç–µ –º—ã –Ω–µ–º–Ω–æ–≥–æ –∏–∑–º–µ–Ω–∏–ª–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, —á—Ç–æ–±—ã —Ç–µ–±–µ –±—ã–ª–æ —É–¥–æ–±–Ω–µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º —Å–µ—Ä–≤–∏—Å–æ–º.\n\n"
        "–ö—Ä–æ–º–µ —Ç–æ–≥–æ, –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º—ã –ø—Ä–æ–¥–ª–∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏!\n"
        "–ß—Ç–æ–±—ã –ø—Ä–æ–¥–ª–µ–Ω–∏–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, —Ç–µ–±–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–∏ –∫–ª—é—á–∏. "
        "–î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ–π–¥–∏ –≤ <i>‚Äú–ù–∞—Å—Ç—Ä–æ–π–∫–∏‚Äù</i> > <i>‚Äú–ú–æ–∏ –∫–ª—é—á–∏‚Äù</i>,"
        " —Å–∫–æ–ø–∏—Ä—É–π –∫–ª—é—á –∏ –≤—Å—Ç–∞–≤—å –µ–≥–æ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ <b>Outline</b>.\n\n"
        "–î–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤–æ—Å–ø–æ–ª—å–∑—É–π—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π:\n\n"
        "üõí <b>–ö—É–ø–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</b> - –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∞—Ä–∏—Ñ—ã –∏ —Å–∫–∏–¥–∫–∏\n\n"
        "üë´ <b>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</b> - –ø—Ä–∏–≥–ª–∞—à–∞–π –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π\n\n"
        "‚öôÔ∏è <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> -  –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª—é—á–∞—Ö –∏ —Å–º–µ–Ω–µ —Å—Ç—Ä–∞–Ω—ã\n\n"
    )
